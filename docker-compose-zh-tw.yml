version: '3.8'

services:
  gpt-load:
    # 使用繁體中文版映像
    image: charles0568/gpt-load:zh-tw
    container_name: gpt-load-zh-tw
    ports:
      - "${PORT:-3001}:3001"
    environment:
      # 基本配置
      - AUTH_KEY=${AUTH_KEY:-sk-123456}
      - TZ=Asia/Taipei
      # 資料庫配置（預設使用 SQLite）
      - DATABASE_DSN=${DATABASE_DSN:-./data/gpt-load.db}
      # Redis 配置（可選）
      - REDIS_DSN=${REDIS_DSN:-}
      # 伺服器配置
      - PORT=3001
      - HOST=0.0.0.0
      # 日誌配置
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_FORMAT=${LOG_FORMAT:-text}
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    restart: unless-stopped
    stop_grace_period: ${SERVER_GRACEFUL_SHUTDOWN_TIMEOUT:-10}s
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "-T", "10", "-O", "/dev/null", "http://localhost:3001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # 如果需要使用外部資料庫，請取消以下註解
    # depends_on:
    #   - mysql
    #   - redis

  # MySQL 資料庫（可選）
  # mysql:
  #   image: mysql:8.2
  #   container_name: gpt-load-mysql
  #   restart: unless-stopped
  #   environment:
  #     MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-123456}
  #     MYSQL_DATABASE: ${MYSQL_DATABASE:-gpt_load}
  #     MYSQL_USER: ${MYSQL_USER:-gptload}
  #     MYSQL_PASSWORD: ${MYSQL_PASSWORD:-123456}
  #   volumes:
  #     - ./data/mysql:/var/lib/mysql
  #   ports:
  #     - "3306:3306"
  #   healthcheck:
  #     test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p${MYSQL_ROOT_PASSWORD:-123456}"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # PostgreSQL 資料庫（可選）
  # postgres:
  #   image: postgres:16
  #   container_name: gpt-load-postgres
  #   restart: unless-stopped
  #   environment:
  #     POSTGRES_USER: ${POSTGRES_USER:-gptload}
  #     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-123456}
  #     POSTGRES_DB: ${POSTGRES_DB:-gpt_load}
  #   volumes:
  #     - ./data/postgres:/var/lib/postgresql/data
  #   ports:
  #     - "5432:5432"
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-gptload} -d ${POSTGRES_DB:-gpt_load}"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # Redis 快取（可選）
  # redis:
  #   image: redis:7-alpine
  #   container_name: gpt-load-redis
  #   restart: unless-stopped
  #   command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-123456}
  #   volumes:
  #     - ./data/redis:/data
  #   ports:
  #     - "6379:6379"
  #   healthcheck:
  #     test: ["CMD", "redis-cli", "--raw", "incr", "ping"]
  #     interval: 10s
  #     timeout: 3s
  #     retries: 5

# 網路配置（可選）
# networks:
#   gpt-load-network:
#     driver: bridge

# 資料卷配置（可選）
# volumes:
#   mysql-data:
#   postgres-data:
#   redis-data:
